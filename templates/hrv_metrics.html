<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>HRV Metrics per Activity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
	form { display: grid; gap: 16px; align-items: start; }
	label { display: block; font-size: 12px; color: #444; margin-bottom: 4px; }
	input { width: 100%; padding: 8px; box-sizing: border-box; }
	button, a.button { padding: 10px 14px; border: 1px solid #ccc; background: #f7f7f7; cursor: pointer; border-radius: 8px; text-decoration: none; color: #222; }
	.meta { margin-top: 10px; color: #555; }
	.pill { display: inline-block; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; font-size: 12px; margin-right: 6px; background: #f7f7f7; }
	table { width: 100%; border-collapse: collapse; margin-top: 18px; font-size: 14px; }
	th, td { border: 1px solid #e5e5e5; padding: 8px 10px; text-align: left; }
	th { background: #fafafa; }
	.btn { display: inline-block; padding: 10px 14px; border: 1px solid #ccc; background: #f7f7f7; color: #222; text-decoration: none; border-radius: 8px; cursor: pointer; font: inherit; line-height: 1; -webkit-appearance: none; appearance: none; }
    .search-btn { margin-right: 4px; margin-left: 4px; background: #0033cc; color: #FFFFFF; }
    .page-header { display: flex; align-items: center; gap: 12px; }
    .highlight-row { background-color: #e6f2ff; }
    .form-row { display: flex; align-items: flex-end; gap: 20px; }
    .form-item label { display: block; font-size: 12px; color: #444; margin-bottom: 4px; }
    input[type="file"] { padding: 6px; font-size: 13px; }
    .checkboxes label { display: inline-flex; align-items: center; margin-right: 16px; font-size: 13px; color: #333; }
  </style>
</head>
<body>
    <div class="page-header">
		<a class="btn" href="{% url 'data_index' %}">
			Back</a>
		<h1>HRV Metrics per Activity</h1>
    </div>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-row">
        <div class="form-item">
          <label for="file">Upload IBI Processed CSV</label>
          <input type="file" id="file" name="file" accept=".csv,.xls,.xlsx" required>
        </div>
        <div class="form-item checkboxes">
          <label><input type="checkbox" name="include_window" value="1" checked>Include Sliding Window</label>
          <label><input type="checkbox" name="include_lib" value="1" checked>Include PyHRV</label>
          <label><input type="checkbox" name="include_custom" value="1" checked>Include Custom</label>
        </div>
      </div>

      <div class="actions">
        <button class="btn" type="submit" name="action" value="view">Compute &amp; View</button>
        <button class="btn search-btn" type="submit" name="download" value="1">Compute &amp; Download CSV</button>
      </div>
    </form>

    {% if error %}<div class="error">{{ error }}</div>{% endif %}

    <h4>HRV Metrics by PyHRV lib</h4>
    <table>
      <thead>
          <tr>
            <th>Activity</th>
            <th>Type</th>
            <th>Mean HR</th>
            <th>Mean RR</th>
            <th>RMSSD</th>
            <th>RMSSD chunks</th>
            <th>SDNN</th>
            <th>SDNN chunks</th>
            <th>NN50</th>
            <th>NN50 chunks</th>
            <th>pNN50</th>
            <th>pNN50 chunks</th>
            <th>TINN</th>
            <th>TINN chunks</th>
            <th>Stress</th>
            <th>PNS</th>
            <th>SNS</th>
            <th>LF</th>
            <th>HF</th>
            <th>LF / HF</th>
            <th>SD1</th>
            <th>SD2</th>
            <th>SD2 / SD1</th>
            <th>ApEn</th>
            <th>SampEn</th>
            <th>DFA_a1</th>
            <th>DFA_a2</th>
          </tr>
      </thead>
      <tbody>
	    {% if results_lib and results_lib|length %}
          {% for r in results_lib %}
            <tr class="{% if r.activityType == 'delaygratification' %}highlight-row{% endif %}">
              <td>{{ r.activity_id }}</td>
              <td>{{ r.activityType }}</td>
              <td>{{ r.mean_hr|floatformat:2 }}</td>
              <td>{{ r.mean_rr|floatformat:2 }}</td>
              <td>{{ r.rmssd|floatformat:3 }}</td>
              <td>{{ r.rmssd_chunks|floatformat:3 }}</td>
              <td>{{ r.sdnn|floatformat:3 }}</td>
              <td>{{ r.sdnn_chunks|floatformat:3 }}</td>
              <td>{{ r.nn50|floatformat:0 }}</td>
              <td>{{ r.nn50_chunks|floatformat:0 }}</td>
              <td>{{ r.pnn50|floatformat:3 }}</td>
              <td>{{ r.pnn50_chunks|floatformat:3 }}</td>
              <td>{{ r.tinn|floatformat:3 }}</td>
              <td>{{ r.tinn_chunks|floatformat:3 }}</td>
              <td>{{ r.stress_index|floatformat:2 }}</td>
              <td>{{ r.pns_index|floatformat:3 }}</td>
              <td>{{ r.sns_index|floatformat:3 }}</td>
              <td>{{ r.lf|floatformat:3 }}</td>
              <td>{{ r.hf|floatformat:3 }}</td>
              <td>{{ r.lf_hf|floatformat:3 }}</td>
              <td>{{ r.sd1|floatformat:3 }}</td>
              <td>{{ r.sd2|floatformat:3 }}</td>
              <td>{{ r.sd2_sd1|floatformat:3 }}</td>
              <td>{{ r.ap_en|floatformat:3 }}</td>
              <td>{{ r.samp_en|floatformat:3 }}</td>
              <td>{{ r.dfa_a1|floatformat:3 }}</td>
              <td>{{ r.dfa_a2|floatformat:3 }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="28">No rows displayed.</td></tr>
        {% endif %}
      </tbody>
    </table>

    <h4>HRV Metrics using sliding window</h4>
    <table>
      <thead>
          <tr>
            <th>Activity</th>
            <th>Type</th>
            <th>Mean HR</th>
            <th>Mean RR</th>
            <th>RMSSD</th>
            <th>RMSSD chunks</th>
            <th>SDNN</th>
            <th>SDNN chunks</th>
            <th>NN50</th>
            <th>NN50 chunks</th>
            <th>pNN50</th>
            <th>pNN50 chunks</th>
            <th>TINN</th>
            <th>TINN chunks</th>
            <th>Stress</th>
            <th>PNS</th>
            <th>SNS</th>
            <th>LF</th>
            <th>HF</th>
            <th>LF / HF</th>
            <th>SD1</th>
            <th>SD2</th>
            <th>SD2 / SD1</th>
            <th>ApEn</th>
            <th>SampEn</th>
            <th>DFA_a1</th>
            <th>DFA_a2</th>
          </tr>
      </thead>
      <tbody>
	    {% if results_lib_windows and results_lib_windows|length %}
          {% for r in results_lib_windows %}
            <tr class="{% if r.activityType == 'delaygratification' %}highlight-row{% endif %}">
              <td>{{ r.activity_id }}</td>
              <td>{{ r.activityType }}</td>
              <td>{{ r.mean_hr|floatformat:2 }}</td>
              <td>{{ r.mean_rr|floatformat:2 }}</td>
              <td>{{ r.rmssd|floatformat:3 }}</td>
              <td>{{ r.rmssd_chunks|floatformat:3 }}</td>
              <td>{{ r.sdnn|floatformat:3 }}</td>
              <td>{{ r.sdnn_chunks|floatformat:3 }}</td>
              <td>{{ r.nn50|floatformat:0 }}</td>
              <td>{{ r.nn50_chunks|floatformat:0 }}</td>
              <td>{{ r.pnn50|floatformat:3 }}</td>
              <td>{{ r.pnn50_chunks|floatformat:3 }}</td>
              <td>{{ r.tinn|floatformat:3 }}</td>
              <td>{{ r.tinn_chunks|floatformat:3 }}</td>
              <td>{{ r.stress_index|floatformat:2 }}</td>
              <td>{{ r.pns_index|floatformat:3 }}</td>
              <td>{{ r.sns_index|floatformat:3 }}</td>
              <td>{{ r.lf|floatformat:3 }}</td>
              <td>{{ r.hf|floatformat:3 }}</td>
              <td>{{ r.lf_hf|floatformat:3 }}</td>
              <td>{{ r.sd1|floatformat:3 }}</td>
              <td>{{ r.sd2|floatformat:3 }}</td>
              <td>{{ r.sd2_sd1|floatformat:3 }}</td>
              <td>{{ r.ap_en|floatformat:3 }}</td>
              <td>{{ r.samp_en|floatformat:3 }}</td>
              <td>{{ r.dfa_a1|floatformat:3 }}</td>
              <td>{{ r.dfa_a2|floatformat:3 }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="28">No rows displayed.</td></tr>
        {% endif %}
      </tbody>
    </table>

    <h4>HRV Metrics by custom formulas</h4>
    <table>
      <thead>
          <tr>
            <th>Activity</th>
            <th>Type</th>
            <th>Mean HR</th>
            <th>Mean RR</th>
            <th>RMSSD</th>
            <th>SDNN</th>
            <th>NN50</th>
            <th>pNN50</th>
            <th>TINN</th>
            <th>Stress</th>
            <th>PNS</th>
            <th>SNS</th>
            <th>LF</th>
            <th>HF</th>
            <th>LF / HF</th>
            <th>SD1</th>
            <th>SD2</th>
            <th>SD2 / SD1</th>
            <th>ApEn</th>
            <th>SampEn</th>
            <th>DFA_a1</th>
            <th>DFA_a2</th>
          </tr>
      </thead>

      <tbody>
	    {% if results and results|length %}
          {% for r in results %}
            <tr class="{% if r.activityType == 'delaygratification' %}highlight-row{% endif %}">
              <td>{{ r.activity_id }}</td>
              <td>{{ r.activityType }}</td>
              <td>{{ r.mean_hr|floatformat:2 }}</td>
              <td>{{ r.mean_rr|floatformat:2 }}</td>
              <td>{{ r.rmssd|floatformat:3 }}</td>
              <td>{{ r.sdnn|floatformat:3 }}</td>
              <td>{{ r.nn50|floatformat:0 }}</td>
              <td>{{ r.pnn50|floatformat:3 }}</td>
              <td>{{ r.tinn|floatformat:3 }}</td>
              <td>{{ r.stress_index|floatformat:2 }}</td>
              <td>{{ r.pns_index|floatformat:3 }}</td>
              <td>{{ r.sns_index|floatformat:3 }}</td>
              <td>{{ r.lf|floatformat:3 }}</td>
              <td>{{ r.hf|floatformat:3 }}</td>
              <td>{{ r.lf_hf|floatformat:3 }}</td>
              <td>{{ r.sd1|floatformat:3 }}</td>
              <td>{{ r.sd2|floatformat:3 }}</td>
              <td>{{ r.sd2_sd1|floatformat:3 }}</td>
              <td>{{ r.ap_en|floatformat:3 }}</td>
              <td>{{ r.samp_en|floatformat:3 }}</td>
              <td>{{ r.dfa_a1|floatformat:3 }}</td>
              <td>{{ r.dfa_a2|floatformat:3 }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="22">No rows displayed.</td></tr>
        {% endif %}
      </tbody>
    </table>

</body>
</html>
